---
title: "Introduction to `glca`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{glca}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, message = FALSE, warning = FALSE}
library(glca)
set.seed(1)
```

## Example (1) - Attitude toward abortion

The dataset `gss08` taken from the 2008 General Social Survey (Smith et al., 2010) includes six binary manifest items measuring 355 respondents’ attitudes toward abortion following the strategy suggested by McCutcheon, 1987. For each item, respondents were asked whether abortion should be legalized under various circumstances: a strong chance of serious defect in the baby (`DEFECT`), pregnancy is seriously endangering the woman’s health (`HLTH`), pregnancy as a result of rape (`RAPE`), due to low income, the family cannot afford any more children (`POOR`), woman is unmarried and has no plans to marry the man (`SINGLE`), and woman is married but does not want more children (`NOMORE`). Each item has two possible levels of response (i.e., "YES" or "NO"). `gss08` also include five covariates: `AGE`, `GENDER`, `RACE`, `DEGREE` and `REGION` of respondents.

```{r data1}
data("gss08")
str(gss08)
```

```{r lca, cache = TRUE}
lca2 = glca(item(DEFECT, HLTH, RAPE, POOR, SINGLE, NOMORE) ~ 1,
            data = gss08, nclass = 2)
lca3 = glca(item(DEFECT, HLTH, RAPE, POOR, SINGLE, NOMORE) ~ 1,
            data = gss08, nclass = 3)
lca4 = glca(item(DEFECT, HLTH, RAPE, POOR, SINGLE, NOMORE) ~ 1,
            data = gss08, nclass = 4)

gofglca(lca2, lca3, lca4, test = "boot")
```

```{r lca3}
summary(lca3)
plot(lca3)
```

```{r mglca}
## Multiple-group LCA (MGLCA)
mglca = glca(item(DEFECT, HLTH, RAPE, POOR, SINGLE, NOMORE) ~ 1,
             group = DEGREE, data = gss08, nclass = 3)
plot(mglca)
## Multiple-group LCA with covariate(s) (MGLCR)
mglcr1 = glca(item(DEFECT, HLTH, RAPE, POOR, SINGLE, NOMORE) ~ SEX,
             group = DEGREE, data = gss08, nclass = 3)
mglcr2 = glca(item(DEFECT, HLTH, RAPE, POOR, SINGLE, NOMORE) ~ SEX,
             group = DEGREE, data = gss08, nclass = 3, coeff.inv = FALSE)
gofglca(mglca, mglcr1, mglcr2, test = "chisq")
coef(mglcr1)
```

## Example (2) - Tobacco smoking behavior

The dataset *nyts18* comprises five dichotomized manifest items on the life-time experience of several types of tobacco including cigarettes (ECIGT), cigars (ECIGAR), chewing tobacco/snuff/or dip (ESLT), electronic cigarettes (EELCIGT), and hookah or water pipe (EHOOKAH) taken from the National Youth Tobacco Survey 2018 (NYTS 2018, <https://www.cdc.gov/tobacco/data_statistics/surveys/nyts>). The sample considered in this study includes 1,743 non-Hispanic white students from 45 schools. The number of sampled students from each school is in the range of 30 to 50. The school membership can be identified by SCH_ID and each school is classified as either middle or high school (SCH_LEV).

```{r data2}
data("nyts18")
str(nyts18)
```

```{r mlca, cache = TRUE}
## Multilevel LCA (MLCA)
mlca2 = glca(item(ECIGT, ECIGAR, ESLT, EELCIGT, EHOOKAH) ~ 1, group = SCH_ID, 
             data = nyts18, nclass = 3, ncluster = 2)
mlca3 = glca(item(ECIGT, ECIGAR, ESLT, EELCIGT, EHOOKAH) ~ 1, group = SCH_ID, 
             data = nyts18, nclass = 3, ncluster = 3)
mlca4 = glca(item(ECIGT, ECIGAR, ESLT, EELCIGT, EHOOKAH) ~ 1, group = SCH_ID, 
             data = nyts18, nclass = 3, ncluster = 4)
gofglca(mlca2, mlca3, mlca4, test = "boot")
```
```{r mlca2}
summary(mlca3)
plot(mlca3)
```

```{r mlcr, cache = TRUE} 
## MLCA with covariate(s) (MLCR)
# (SEX: level-1 covariate, SCH_LEV: level-2 covariate)
mlcr2 = glca(item(ECIGT, ECIGAR, ESLT, EELCIGT, EHOOKAH) ~ SEX + SCH_LEV,
            group = SCH_ID, data = nyts18, nclass = 3, ncluster = 2)
mlcr3 = glca(item(ECIGT, ECIGAR, ESLT, EELCIGT, EHOOKAH) ~ SEX + SCH_LEV,
            group = SCH_ID, data = nyts18, nclass = 3, ncluster = 2)
gofglca(mlcr2, mlcr3, test = "boot")
```

```{r mlcr2}
coef(mlcr2)
plot(mlcr2)
```
